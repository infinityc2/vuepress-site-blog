(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{188:function(t,a,s){"use strict";s.r(a);var r=s(0),e=Object(r.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"infrastructure-การทำ-provisioning-อย่างง่ายด้วย-docker-vagrant"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#infrastructure-การทำ-provisioning-อย่างง่ายด้วย-docker-vagrant","aria-hidden":"true"}},[t._v("#")]),t._v(" [Infrastructure] การทำ provisioning อย่างง่ายด้วย docker + vagrant")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://miro.medium.com/max/700/0*I7aLTLcM-14ZPeNu.jpg",alt:"alt text"}})]),t._v(" "),s("h3",{attrs:{id:"required"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#required","aria-hidden":"true"}},[t._v("#")]),t._v(" Required")]),t._v(" "),s("ul",[s("li",[t._v("Ubuntu 18.04 or Later")]),t._v(" "),s("li",[t._v("Vagrant")]),t._v(" "),s("li",[t._v("Docker")]),t._v(" "),s("li",[t._v("tmux (สำหรับเปิด terminal หลายตัวในหน้าเดียว)")]),t._v(" "),s("li",[t._v("Oracle VM Virtualbox v5.2")])]),t._v(" "),s("h3",{attrs:{id:"สร้าง-virtualbox-ด้วย-vagrant"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#สร้าง-virtualbox-ด้วย-vagrant","aria-hidden":"true"}},[t._v("#")]),t._v(" สร้าง Virtualbox ด้วย vagrant")]),t._v(" "),s("p",[t._v("เปิด "),s("code",[t._v("terminal")]),t._v(" โดยกดปุ่ม "),s("code",[t._v("ctrl + alt + T")]),t._v(" แล้วให้ทำการสร้างโฟลเดอร์เพื่อใช้ในการสร้าง virtualbox ใช้คำสั่งดังนี้")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ubuntu "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ubuntu\n")])])]),s("p",[t._v("พิมพ์คำสั่งใน "),s("code",[t._v("terminal")]),t._v(" ดังนี้")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("vagrant init ubuntu/bionic64\n")])])]),s("p",[t._v("vagrant init เป็นคำสั่งของ vagrant ที่ใช้ในการเริ่มต้นสร้าง virtualbox โดยมีระบบปฏิบัติการเป็น "),s("code",[t._v("ubuntu/bionic64")])]),t._v(" "),s("p",[t._v("จะได้ไฟล์ที่ชื่อว่า "),s("code",[t._v("Vagrantfile")]),t._v(" ให้ทำการเปิดไฟล์นี้แล้วแก้เป็น")]),t._v(" "),s("div",{staticClass:"language-ruby extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ruby"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Vagrant")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("configure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n   config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("box "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ubuntu/bionic64"')]),t._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v("times "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("define "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"box'),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("box"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n     box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"box'),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('"')]),t._v("\n     box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("network "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private_network"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.33.1'),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("#{")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token delimiter tag"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n   config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("provider "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"virtualbox"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("vb"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    vb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1024"')]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("ส่วนของ code ใน Vagrantfile เป็นภาษา Ruby ในส่วนบรรทัดที่ 2 บอกว่าเป็น virtualbox ที่มีระบบปฏิบัติการ ubuntu/bionic64 บรรทัดที่ 4 เป็นลูปทำ 3 ครั้ง เพื่อสร้าง virtualbox 3 ตัว บรรทัดที่ 6 เป็นการตั้งชื่อให้กับ virtualbox บรรทัดที่ 7 เป็นการกำหนด IP ให้กับ virtualbox และบรรทัดที่ 12 เป็นการกำหนดการใช้ ram ของ virtualbox แต่ละตัว โดยทั้ง 3 ตัว มี ram 1 GB\nไปที่ terminal แล้วใช้คำสั่ง")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("vagrant up\n")])])]),s("p",[t._v("vagrant up เป็นคำสั่งในการสร้าง virtualbox ซึ่งจะใช้เวลาในการสร้างในระยะเวลาหนึ่ง")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://miro.medium.com/max/700/1*B0QxwuGc6nPkqWoMYRi67Q.png",alt:"shell"}})]),t._v(" "),s("p",[t._v("เมื่อสร้างเสร็จแล้วให้ทำการแบ่ง terminal หลายๆตัว")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("tmux\n")])])]),s("p",[t._v("เมื่อเข้าโหมด tmux แล้วให้กด "),s("code",[t._v("ctrl + b")]),t._v(" แล้วปล่อย และกด "),s("code",[t._v("shift + 5")]),t._v(" หรือ "),s("code",[t._v("shift + ‘")]),t._v(" (“5” จะแบ่ง terminal เป็นแนวตั้ง ‘ จะแบ่ง terminal เป็นแนวนอน) แบ่งทั้งหมดจำนวน 4 ตัว")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://miro.medium.com/max/700/1*lanEI6MCy8ICeZ3p8ZuoHw.png",alt:"shell"}})]),t._v(" "),s("blockquote",[s("p",[t._v("การย้ายตำแหน่ง curser ให้กด ctrl + b แล้วปล่อยตามด้วยลูกศรทิศทาง")])]),t._v(" "),s("p",[t._v("ให้ terminal แต่ละตัวใช้งาน virtualbox โดยใช้คำสั่ง")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("vagrant "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" box0\nvagrant "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" box1\nvagrant "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" box2\n")])])]),s("p",[s("img",{attrs:{src:"https://miro.medium.com/max/700/1*4jzlkVi54wiBYQe_DJqS5w.png",alt:"shell"}})]),t._v(" "),s("p",[t._v("สังเกตได้ว่าชื่อ user เปลี่ยนไป คือ เรากำลังใช่งาน virtualbox อยู่ในขณะนี้")]),t._v(" "),s("blockquote",[s("p",[t._v("ให้ทำการตรวจสอบว่า virtualbox แต่ละตัวสามารถติดตั้ง docker ได้หรือไม่โดยใช้คำสั่ง "),s("code",[t._v("ping docker.com")])])]),t._v(" "),s("p",[t._v("ทำการติดตั้ง docker ทั้ง 3 ตัว")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -sSL https://get.docker.com "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),s("p",[t._v("เมื่อติดตั้งเสร็จแล้วให้ไปที่เครื่อง box0 แล้วใช้คำสั่ง")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker swarm init --advertise-addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".33.10\n")])])]),s("p",[s("img",{attrs:{src:"https://miro.medium.com/max/633/1*BXF78c6Jt588-Tm0se0dbw.jpeg",alt:"shyell"}})]),t._v(" "),s("p",[t._v("นำคำสั่ง docker swarm join ที่ได้จากเครื่อง box0 ไปใช้ในเครื่องที่เหลือเพื่อเชื่อมแต่ละ node เข้าด้วยกัน")]),t._v(" "),s("p",[t._v("หากเชื่อมต่อสำเร็จจะขึ้นว่า "),s("code",[t._v("“This node joined a swarm as a worker.”")])]),t._v(" "),s("blockquote",[s("p",[t._v("เพื่อเช็คว่าแต่ละเครื่องเชื่อมต่อกันอยู่จริงให้ใช้คำสั่ง ping [ip ของอีกเครื่อง]")])]),t._v(" "),s("p",[t._v("และหลังจากใช้งานเสร็จแล้วควรทำลาย virtualbox ทิ้งด้วยคำสั่ง")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("vagrant destroy\n")])])]),s("h3",{attrs:{id:"สรุป"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#สรุป","aria-hidden":"true"}},[t._v("#")]),t._v(" สรุป")]),t._v(" "),s("p",[t._v("สิ่งที่ได้ทำมาทั้งหมดเราได้สร้าง virtualbox มาทั้งหมด 3 ตัวด้วย vagrant และใช้ docker swarm ทำ provisioning ให้ทั้ง 3 ตัวเชื่อมต่อกันและได้ server ออกมาขนาดเล็ก และทำออกมาด้วยขั้นตอนง่าย ๆ")]),t._v(" "),s("hr"),t._v(" "),t._l(t.$page.frontmatter.categories,function(t,a){return s("Badge",{key:a,attrs:{text:t}})})],2)},[],!1,null,null,null);a.default=e.exports}}]);